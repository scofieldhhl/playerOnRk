package org.app.enjoy.music.util;import android.content.Context;import android.os.AsyncTask;import android.os.Environment;import android.text.TextUtils;import android.util.Log;import org.app.enjoy.music.data.MusicData;import org.app.enjoy.music.tool.Contsant;import org.app.enjoy.music.tool.LogTool;import java.io.File;import java.net.PortUnreachableException;import java.util.ArrayList;import java.util.List;/** * Created by victor on 2016/6/14. */public class SearchMusicTask {    private String TAG = "SearchMusicTask";    private String[] arrExtension = new String[]{"dsf","dff","dst","dsd", "wma", "aif", "aac"};    private OnSearchMusicListener mOnSearchMusicListener;    private Context mContext;    private List<MusicData> musicList = new ArrayList<>();    public interface OnSearchMusicListener {        void OnSearchComplete (List<MusicData> musicList);    }    public SearchMusicTask(Context context) {        mContext = context;    }    public void executeSearch (OnSearchMusicListener listener) {        mOnSearchMusicListener = listener;        new SearchTask().execute();    }    class SearchTask extends AsyncTask<String,Integer,List<MusicData>>{        @Override        protected List<MusicData> doInBackground(String... params) {            GetFiles(getSDPath(),arrExtension, true);            return musicList;        }        @Override        protected void onPostExecute(List<MusicData> musicDatas) {           if (mOnSearchMusicListener != null) {               mOnSearchMusicListener.OnSearchComplete(musicDatas);           }        }    }    /**     * 遍历文件夹，搜索指定扩展名的文件     * */    public void GetFiles(String Path, String[] arrExtension, boolean IsIterative)  //搜索目录，扩展名，是否进入子文件夹    {        if(Path == null || TextUtils.isEmpty(Path)){            return;        }        File[] files = new File(Path).listFiles();        for (int i = 0; i < files.length; i++)        {            File f = files[i];            if (f.isFile())            {                String[] arrFile = f.getPath().split("\\.");                if(arrFile != null && arrFile.length >0){                    int length = arrFile.length;                    if(arrFile[length -1] != null){                        for(String str : arrExtension){                            if(arrFile[length -1].equalsIgnoreCase(str)){                                MusicData md = new MusicData();                                String[] arrFileName = f.getPath().split("/");                                md.title = arrFile[length -1];                                if(arrFileName != null && arrFileName.length > 0){                                    md.title = arrFileName[arrFileName.length - 1].substring(0,arrFileName[arrFileName.length - 1].indexOf("."));                                }                                md.duration = 0;                                md.artist = "<unknown>";                                md.artistId = "1";                                md.displayName = md.title;                                md.data = f.getPath();                                md.path = f.getPath();                                LogTool.i( f.getPath());                                md.size = String.valueOf(f.length());                                musicList.add(md);                                break;                            }                        }                    }                }                if (!IsIterative)                    break;            }            else if (f.isDirectory() && f.getPath().indexOf("/.") == -1)  //忽略点文件（隐藏文件/文件夹）                GetFiles(f.getPath(), arrExtension, IsIterative);        }    }    public String getSDPath(){        File sdDir = null;        boolean sdCardExist = Environment.getExternalStorageState()                .equals(Environment.MEDIA_MOUNTED);   //判断sd卡是否存在        if(sdCardExist){            sdDir = Environment.getExternalStorageDirectory();//获取跟目录        }        if(sdDir != null){            return sdDir.toString();        }else{            return null;        }    }}